name: Dcoker image report

on:
  workflow_call:
    inputs:
      docker_image_status:
        required: true
        type: string
      docker_image_name:
        required: true
        type: string
      new_release_version:
        required: false
        type: string
        default: ""
      project:
        required: true
        type: string
      repository:
        required: true
        type: string
    secrets:
      DISCORD_WEBHOOK:
        required: true

jobs:
  send_docker_image_report:
    name: Send docker image report
    runs-on: ubuntu-latest

    steps:
      - name: Trigger webhook
        run: |
          STATUS="${{ inputs.docker_image_status }}"
          IMAGE="${{ inputs.docker_image_name }}"
          VERSION="${{ inputs.new_release_version }}"
          PROJECT="${{ inputs.project }}"
          REPO="${{ inputs.repository }}"

          RESULT_ICON=""
          RESULT_MESS=""

          if [[ "$STATUS" == "success" && -n "$VERSION" ]]; then
            RESULT_ICON="✅"
            RESULT_MESS="Success"
          else
            RESULT_ICON="❌"
            RESULT_MESS="Failed"
            IMAGE="no new image built"
            VERSION="N/A"
          fi

          DATE=$(date +"%d/%m/%Y %H:%M")

          curl -H "Content-Type: application/json" \
            -X POST \
            -d "{
              \"embeds\": [
                {
                  \"description\": \"> \`$RESULT_ICON\` **Docker image report**\",
                  \"fields\": [
                    {\"name\": \"\`📕\` Project\", \"value\": \"\`$PROJECT\`\"},
                    {\"name\": \"\`📅\` Date\", \"value\": \"$DATE\", \"inline\": true},
                    {\"name\": \"\`🗒️\` Result\", \"value\": \"$RESULT_MESS\", \"inline\": true},
                    {\"name\": \"\`#️⃣\` Version\", \"value\": \"\`$VERSION\`\", \"inline\": true},
                    {\"name\": \"\`📦\` Image\", \"value\": \"\`\`\`$IMAGE\`\`\`\"},
                    {\"name\": \"\`🔗\` Repository\", \"value\": \"$REPO\"}
                  ],
                  \"color\": 65344
                }
              ]
            }" \
            ${{ secrets.DISCORD_WEBHOOK }}


name: Dcoker image report

on:
  workflow_call:
    inputs:
      docker_image_status:
        required: true
        type: string
      docker_image_name:
        required: true
        type: string
      new_release_version:
        required: true
        type: string
        default: ""
    secrets:
      DISCORD_WEBHOOK:
        required: true

jobs:
  send_docker_image_report:
    name: Send docker image report
    runs-on: ubuntu-latest

    steps:
      - name: Trigger webhook
        run: |
          RESULT_ICON=""
          RESULT_MESS=""
          IMAGE="${{ inputs.docker_image_name }}"
          VERSION="${{ inputs.new_release_version }}"

          if [[ ${{ inputs.docker_image_status }} == "success" ]]; then
            RESULT_ICON="‚úÖ"
            RESULT_MESS="Success"
          elif [[ ${{ inputs.new_release_version }} == "" ]]; then
            RESULT_ICON="‚ùå"
            RESULT_MESS="Failed"
            IMAGE="no new image built"
            VERSION="N/A"
          else
            RESULT_ICON="‚ùå"
            RESULT_MESS="Failed"
            IMAGE="no new image built"
            VERSION="N/A"
          fi

          DATE=$(date +"%d/%m/%Y %H:%M")

          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"embeds\": [
              {
                \"description\": \"> \`‚úÖ\` **Docker image report**\",
                \"fields\": [
                  {
                    \"name\": \"\`üìÖ\` Date\",
                    \"value\": \"$DATE\",
                    \"inline\": true
                  },
                  {
                    \"name\": \"\`üóíÔ∏è\` Result\",
                    \"value\": \"$RESULT_MESS\",
                    \"inline\": true
                  },
                  {
                    \"name\": \"\`#Ô∏è‚É£\` Version\",
                    \"value\": \"$VERSION\",
                    \"inline\": true
                  },
                  {
                    \"name\": \"\`üì¶\` Image\",
                    \"value\": \"\`\`\`${{ inputs.docker_image_name }}\`\`\`\"
                  }
                ],
                \"color\": 65344
              }
            ]
          }" \
          ${{ secrets.DISCORD_WEBHOOK }}

